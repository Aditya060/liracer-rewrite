A complete rewrite of liracer.
